Architecture Firestore - UnCoachUneSalle

ğŸ”¥ Firestore Database
â”‚
â”œâ”€â”€ ğŸ“ users (Collection)
â”‚   â””â”€â”€ ğŸ“„ {userId} (Document)
â”‚       â”œâ”€â”€ uid: string
â”‚       â”œâ”€â”€ email: string
â”‚       â”œâ”€â”€ displayName: string
â”‚       â”œâ”€â”€ type: "coach" | "facility"
â”‚       â”œâ”€â”€ phoneNumber: string
â”‚       â”œâ”€â”€ profileImage: string?
â”‚       â”œâ”€â”€ profileImageStoragePath: string?
â”‚       â”œâ”€â”€ isActive: boolean
â”‚       â”œâ”€â”€ fcmToken: string?
â”‚       â”œâ”€â”€ createdAt: timestamp
â”‚       â”œâ”€â”€ updatedAt: timestamp
â”‚       â”œâ”€â”€ lastLoginAt: timestamp?
â”‚       â”œâ”€â”€ verification: {
â”‚       â”‚     identity: boolean,
â”‚       â”‚     identityVerifiedAt: timestamp?,
â”‚       â”‚     insurance: boolean,
â”‚       â”‚     insuranceVerifiedAt: timestamp?,
â”‚       â”‚     license: boolean,
â”‚       â”‚     licenseVerifiedAt: timestamp?,
â”‚       â”‚     backgroundCheck: boolean,
â”‚       â”‚     backgroundCheckAt: timestamp?
â”‚       â”‚   }
â”‚       â”œâ”€â”€ notificationPreferences: {
â”‚       â”‚     emailNotifications: boolean,
â”‚       â”‚     smsNotifications: boolean,
â”‚       â”‚     pushNotifications: boolean,
â”‚       â”‚     bookingUpdates: boolean,
â”‚       â”‚     newMessages: boolean,
â”‚       â”‚     reviews: boolean
â”‚       â”‚   }
â”‚       â”‚
â”‚       â”œâ”€â”€ ğŸ“ coachProfiles (Sous-collection) â† si type == "coach"
â”‚       â”‚   â””â”€â”€ ğŸ“„ {profileId}
â”‚       â”‚
â”‚       â””â”€â”€ ğŸ“ facilityProfiles (Sous-collection) â† si type == "facility"
â”‚           â””â”€â”€ ğŸ“„ {profileId}
â”‚
â”œâ”€â”€ ğŸ“ facilities (Collection)
â”‚   â””â”€â”€ ğŸ“„ {facilityId} (Document)
â”‚       â”œâ”€â”€ ownerId: string (â†’ users/{userId})
â”‚       â”œâ”€â”€ name: string
â”‚       â”œâ”€â”€ description: string
â”‚       â”œâ”€â”€ address: {
â”‚       â”‚     street, city, postalCode, country, lat, lng
â”‚       â”‚   }
â”‚       â”œâ”€â”€ images: string[]
â”‚       â”œâ”€â”€ amenities: { [key]: boolean }
â”‚       â”œâ”€â”€ capacity: number
â”‚       â”œâ”€â”€ hourlyRate: number
â”‚       â”œâ”€â”€ peakHourRate: number?
â”‚       â”œâ”€â”€ peakHours: {
â”‚       â”‚     startTime, endTime, daysOfWeek, multiplier
â”‚       â”‚   }
â”‚       â”œâ”€â”€ rating: number
â”‚       â”œâ”€â”€ reviewsCount: number
â”‚       â”œâ”€â”€ totalBookings: number
â”‚       â”œâ”€â”€ isActive: boolean
â”‚       â”œâ”€â”€ isVerified: boolean
â”‚       â”œâ”€â”€ isFeatured: boolean
â”‚       â”œâ”€â”€ facilityType: string?
â”‚       â”œâ”€â”€ createdAt: timestamp
â”‚       â”œâ”€â”€ updatedAt: timestamp
â”‚       â”‚
â”‚       â”œâ”€â”€ ğŸ“ spaces (Sous-collection)
â”‚       â”‚   â””â”€â”€ ğŸ“„ {spaceId}
â”‚       â”‚       â”œâ”€â”€ facilityId: string
â”‚       â”‚       â”œâ”€â”€ name: string
â”‚       â”‚       â”œâ”€â”€ description: string
â”‚       â”‚       â”œâ”€â”€ capacity: number
â”‚       â”‚       â”œâ”€â”€ images: string[]
â”‚       â”‚       â”œâ”€â”€ equipment: string[]
â”‚       â”‚       â”œâ”€â”€ hourlyRate: number
â”‚       â”‚       â”œâ”€â”€ area: number
â”‚       â”‚       â”œâ”€â”€ isAccessible: boolean
â”‚       â”‚       â”œâ”€â”€ hasParking: boolean
â”‚       â”‚       â”œâ”€â”€ hasShowers: boolean
â”‚       â”‚       â”œâ”€â”€ isAvailable: boolean
â”‚       â”‚       â””â”€â”€ ...
â”‚       â”‚
â”‚       â””â”€â”€ ğŸ“ availability (Sous-collection)
â”‚           â””â”€â”€ ğŸ“„ {availabilityId}
â”‚
â”œâ”€â”€ ğŸ“ bookings (Collection)
â”‚   â””â”€â”€ ğŸ“„ {bookingId} (Document)
â”‚       â”œâ”€â”€ coachId: string (â†’ users/{userId})
â”‚       â”œâ”€â”€ facilityId: string (â†’ facilities/{facilityId})
â”‚       â”œâ”€â”€ spaceId: string
â”‚       â”œâ”€â”€ facilityOwnerId: string (â†’ users/{userId})
â”‚       â”œâ”€â”€ conversationId: string (â†’ messages/{conversationId})
â”‚       â”œâ”€â”€ startTime: timestamp
â”‚       â”œâ”€â”€ endTime: timestamp
â”‚       â”œâ”€â”€ durationHours: number
â”‚       â”œâ”€â”€ status: "pending" | "confirmed" | "in_progress" | "completed" | "cancelled"
â”‚       â”œâ”€â”€ totalPrice: number
â”‚       â”œâ”€â”€ subtotal: number
â”‚       â”œâ”€â”€ platformCommission: number
â”‚       â”œâ”€â”€ platformCommissionPercentage: number
â”‚       â”œâ”€â”€ paymentStatus: "pending" | "completed" | "refunded"
â”‚       â”œâ”€â”€ paymentMethod: string?
â”‚       â”œâ”€â”€ stripePaymentIntentId: string?
â”‚       â”œâ”€â”€ notes: string?
â”‚       â”œâ”€â”€ cancellationReason: string?
â”‚       â”œâ”€â”€ hasReview: boolean
â”‚       â”œâ”€â”€ createdAt: timestamp
â”‚       â”œâ”€â”€ confirmedAt: timestamp?
â”‚       â”œâ”€â”€ completedAt: timestamp?
â”‚       â”‚
â”‚       â”‚ // DonnÃ©es dÃ©normalisÃ©es (pour affichage rapide)
â”‚       â”œâ”€â”€ facilityName: string?
â”‚       â”œâ”€â”€ facilityAddress: string?
â”‚       â”œâ”€â”€ facilityImage: string?
â”‚       â”œâ”€â”€ spaceName: string?
â”‚       â”œâ”€â”€ coachName: string?
â”‚       â””â”€â”€ coachImage: string?
â”‚
â”œâ”€â”€ ğŸ“ reviews (Collection)
â”‚   â””â”€â”€ ğŸ“„ {reviewId} (Document)
â”‚       â”œâ”€â”€ reviewerId: string (â†’ users/{userId})
â”‚       â”œâ”€â”€ revieweeId: string (â†’ users/{userId})
â”‚       â”œâ”€â”€ bookingId: string (â†’ bookings/{bookingId})
â”‚       â”œâ”€â”€ reviewType: "coach_to_facility" | "facility_to_coach"
â”‚       â”œâ”€â”€ overallRating: number (1-5)
â”‚       â”œâ”€â”€ comment: string
â”‚       â”œâ”€â”€ categories: {
â”‚       â”‚     // Si coach_to_facility:
â”‚       â”‚     cleanliness, equipmentQuality, accessibility, atmosphereQuality, valueForMoney
â”‚       â”‚     // Si facility_to_coach:
â”‚       â”‚     professionalism, punctuality, respectOfRules, communication, clientBehavior
â”‚       â”‚   }
â”‚       â”œâ”€â”€ photos: string[]
â”‚       â”œâ”€â”€ isVerified: boolean
â”‚       â”œâ”€â”€ isHidden: boolean
â”‚       â”œâ”€â”€ createdAt: timestamp
â”‚       â”‚
â”‚       â”‚ // DonnÃ©es dÃ©normalisÃ©es
â”‚       â”œâ”€â”€ reviewerName: string?
â”‚       â”œâ”€â”€ reviewerImage: string?
â”‚       â””â”€â”€ facilityName: string?
â”‚
â”œâ”€â”€ ğŸ“ messages (Collection) â† Conversations
â”‚   â””â”€â”€ ğŸ“„ {conversationId} (Document)
â”‚       â”œâ”€â”€ participants: string[] (2 userIds)
â”‚       â”œâ”€â”€ lastMessage: string
â”‚       â”œâ”€â”€ lastMessageTime: timestamp
â”‚       â”œâ”€â”€ lastMessageSenderId: string
â”‚       â”œâ”€â”€ unreadCount: { [userId]: number }
â”‚       â”œâ”€â”€ createdAt: timestamp
â”‚       â”œâ”€â”€ participantsInfo: {
â”‚       â”‚     [userId]: { displayName, profileImage, userType }
â”‚       â”‚   }
â”‚       â”‚
â”‚       â””â”€â”€ ğŸ“ messages (Sous-collection)
â”‚           â””â”€â”€ ğŸ“„ {messageId}
â”‚               â”œâ”€â”€ conversationId: string
â”‚               â”œâ”€â”€ senderId: string
â”‚               â”œâ”€â”€ senderName: string
â”‚               â”œâ”€â”€ senderProfileImage: string?
â”‚               â”œâ”€â”€ text: string
â”‚               â”œâ”€â”€ attachments: [{
â”‚               â”‚     type, url, storagePath, fileName, fileSize
â”‚               â”‚   }]
â”‚               â”œâ”€â”€ isRead: boolean
â”‚               â”œâ”€â”€ readAt: timestamp?
â”‚               â””â”€â”€ createdAt: timestamp
â”‚
â”œâ”€â”€ ğŸ“ payments (Collection) â† GÃ©rÃ© par Cloud Functions
â”‚   â””â”€â”€ ğŸ“„ {paymentId}
â”‚
â”œâ”€â”€ ğŸ“ notifications (Collection) â† GÃ©rÃ© par Cloud Functions
â”‚   â””â”€â”€ ğŸ“„ {notificationId}
â”‚       â”œâ”€â”€ userId: string
â”‚       â”œâ”€â”€ isRead: boolean
â”‚       â”œâ”€â”€ readAt: timestamp?
â”‚       â””â”€â”€ ...
â”‚
â””â”€â”€ ğŸ“ analytics (Collection) â† GÃ©rÃ© par Cloud Functions
    â””â”€â”€ ğŸ“„ {analyticsId}


Relations entre les collections

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   USERS     â”‚â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚  FACILITIES  â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”‚  BOOKINGS   â”‚
â”‚  (Coach)    â”‚         â”‚              â”‚         â”‚             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚                        â”‚                       â”‚
      â”‚                        â”‚                       â”‚
      â–¼                        â–¼                       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   USERS     â”‚         â”‚   SPACES     â”‚         â”‚  REVIEWS    â”‚
â”‚ (Facility)  â”‚         â”‚ (sous-coll)  â”‚         â”‚             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚                                                â”‚
      â”‚                                                â”‚
      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚  MESSAGES   â”‚
                    â”‚(Conversations)
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

C'est une architecture solide et bien pensÃ©e !
Les donnÃ©es dÃ©normalisÃ©es dans bookings et reviews permettent d'Ã©viter
des lectures supplÃ©mentaires pour l'affichage.